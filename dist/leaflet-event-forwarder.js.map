{"version":3,"file":"leaflet-event-forwarder.js","sources":["../src/L.EventForwarder.js"],"sourcesContent":["import L from 'leaflet';\n\nlet _options;\nlet _prevTarget = null;\n\nconst EventForwarder = L.Class.extend({\n\n\tinitialize: function (options) {\n\t\t_options = options;\n\t},\n\n\tenable: function() {\n\t\tif (_options.events.click === true) {\n\t\t\tL.DomEvent.on(_options.map, 'click', this._handleClick, this);\n\t\t}\n\t\tif (_options.events.mousemove === true) {\n\t\t\tL.DomEvent.on(_options.map, 'mousemove', this._throttle(this._handleMouseMove, _options.throttleMs, _options.throttleOptions), this);\n\t\t}\n\t},\n\n\tdisable: function() {\n\t\tL.DomEvent.off(_options.map, 'click', this._handleClick, this);\n\t\tL.DomEvent.off(_options.map, 'mousemove', this._throttle(this._handleMouseMove, _options.throttleMs, _options.throttleOptions), this);\n\t},\n\n\t/**\n\t * Handle `mousemove` event from map, i.e. forwards unhandled events\n\t * @param event\n\t * @private\n\t */\n\t_handleMouseMove: function(event) {\n\n\t\t// we use the maps mousemove event to avoid registering listeners\n\t\t// for each individual layer, however this means we don't receive\n\t\t// the layers mouseover/out events so we need to fudge it a little\n\n\t\tif (event.originalEvent._stopped) { return; }\n\n\t\t// get the target pane\n\t\tvar currentTarget = event.originalEvent.target;\n\t\tvar stopped;\n\t\tvar removed;\n\n\t\t// hide the target node\n\t\tremoved = { node: currentTarget, pointerEvents: currentTarget.style.pointerEvents };\n\t\tcurrentTarget.style.pointerEvents = 'none';\n\n\t\t// attempt to grab the next layer below\n\t\tconst nextTarget = document.elementFromPoint(event.originalEvent.clientX, event.originalEvent.clientY);\n\t\tconst isCanvas = nextTarget.nodeName.toLowerCase() === 'canvas';\n\n\t\t// target has changed so trigger mouseout previous\n\t\tif (_prevTarget && _prevTarget != nextTarget) {\n\t\t\t_prevTarget.dispatchEvent(new MouseEvent('mouseout', event.originalEvent));\n\t\t}\n\t\t_prevTarget = nextTarget;\n\n\t\t// we keep drilling down until we get stopped,\n\t\t// or we reach the map container itself\n\t\tif (\n\t\t\tnextTarget &&\n\t\t\tnextTarget.nodeName.toLowerCase() !== 'body' &&\n\t\t\tnextTarget.classList.value.indexOf('leaflet-container') === -1\n\t\t) {\n\t\t\tlet eventType = isCanvas ? 'mousemove' : 'mouseover';\n\t\t\tvar ev = new MouseEvent(eventType, event.originalEvent);\n\t\t\tstopped = !nextTarget.dispatchEvent(ev);\n\t\t\tif (stopped || ev._stopped) {\n\t\t\t\tL.DomEvent.stop(event);\n\t\t\t}\n\t\t}\n\n\t\t// restore pointerEvents\n\t\tremoved.node.style.pointerEvents = removed.pointerEvents;\n\t},\n\n\t/**\n\t * Handle `click` event from map, i.e. forwards unhandled events\n\t * @param event\n\t * @private\n\t */\n\t_handleClick: function(event) {\n\n\t\tif (event.originalEvent._stopped) { return; }\n\n\t\t// get the target pane\n\t\tvar currentTarget = event.originalEvent.target;\n\t\tvar stopped;\n\t\tvar removed;\n\n\t\t// hide the target node\n\t\tremoved = { node: currentTarget, pointerEvents: currentTarget.style.pointerEvents };\n\t\tcurrentTarget.style.pointerEvents = 'none';\n\n\t\t// attempt to grab the next layer below\n\t\tlet nextTarget = document.elementFromPoint(event.originalEvent.clientX, event.originalEvent.clientY);\n\n\t\t// we keep drilling down until we get stopped,\n\t\t// or we reach the map container itself\n\t\tif (\n\t\t\tnextTarget &&\n\t\t\tnextTarget.nodeName.toLowerCase() !== 'body' &&\n\t\t\tnextTarget.classList.value.indexOf('leaflet-container') === -1\n\t\t) {\n\t\t\tvar ev = new MouseEvent(event.originalEvent.type, event.originalEvent);\n\t\t\tstopped = !nextTarget.dispatchEvent(ev);\n\t\t\tif (stopped || ev._stopped) {\n\t\t\t\tL.DomEvent.stop(event);\n\t\t\t}\n\t\t}\n\n\t\t// restore pointerEvents\n\t\tremoved.node.style.pointerEvents = removed.pointerEvents;\n\t},\n\n\t/**\n\t * Pinched from underscore\n\t * @param func\n\t * @param wait\n\t * @param options\n\t * @returns {Function}\n\t * @private\n\t */\n\t_throttle: function (func, wait, options) {\n\t\tvar context, args, result;\n\t\tvar timeout = null;\n\t\tvar previous = 0;\n\t\tif (!options) options = {};\n\t\tvar later = function() {\n\t\t\tprevious = options.leading === false ? 0 : Date.now();\n\t\t\ttimeout = null;\n\t\t\tresult = func.apply(context, args);\n\t\t\tif (!timeout) context = args = null;\n\t\t};\n\t\treturn function() {\n\t\t\tvar now = Date.now();\n\t\t\tif (!previous && options.leading === false) previous = now;\n\t\t\tvar remaining = wait - (now - previous);\n\t\t\tcontext = this;\n\t\t\targs = arguments;\n\t\t\tif (remaining <= 0 || remaining > wait) {\n\t\t\t\tif (timeout) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\ttimeout = null;\n\t\t\t\t}\n\t\t\t\tprevious = now;\n\t\t\t\tresult = func.apply(context, args);\n\t\t\t\tif (!timeout) context = args = null;\n\t\t\t} else if (!timeout && options.trailing !== false) {\n\t\t\t\ttimeout = setTimeout(later, remaining);\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t}\n\n\n});\n\nL.eventForwarder = function (options) {\n\treturn new EventForwarder(options);\n};\n\nexport default L.eventForwarder;"],"names":["_options","_prevTarget","EventForwarder","L","Class","extend","initialize","options","enable","events","click","DomEvent","on","map","_handleClick","mousemove","_throttle","_handleMouseMove","throttleMs","throttleOptions","disable","off","event","originalEvent","_stopped","currentTarget","target","stopped","removed","node","pointerEvents","style","nextTarget","document","elementFromPoint","clientX","clientY","isCanvas","nodeName","toLowerCase","dispatchEvent","MouseEvent","classList","value","indexOf","eventType","ev","stop","type","func","wait","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout","eventForwarder"],"mappings":"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"}